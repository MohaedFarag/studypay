<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyPal - معاينة التصميم</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        'arabic': ['Noto Sans Arabic', 'sans-serif'],
                        'english': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Noto Sans Arabic', 'Inter', sans-serif;
        }
        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.2s ease;
            text-decoration: none;
            margin-bottom: 4px;
        }
        
        .page-content {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-link-active {
            background-color: #dbeafe;
            color: #1e40af;
            font-weight: 600;
        }
        .nav-link-inactive {
            color: #6b7280;
            background-color: transparent;
        }
        .nav-link-inactive:hover {
            background-color: #f3f4f6;
            color: #374151;
        }
        .dark .nav-link-active {
            background-color: #1e40af;
            color: #dbeafe;
        }
        .dark .nav-link-inactive {
            color: #d1d5db;
        }
        .dark .nav-link-inactive:hover {
            background-color: #374151;
            color: #f9fafb;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .dark .card {
            background-color: #1f2937;
            border-color: #374151;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        .btn-secondary {
            background: #f8fafc;
            color: #475569;
            padding: 12px 24px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .btn-secondary:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .dark .btn-secondary {
            background-color: #374151;
            color: #d1d5db;
            border-color: #4b5563;
        }
        .dark .btn-secondary:hover {
            background: #4b5563;
            color: #f9fafb;
        }
        .stat-card {
            background: linear-gradient(135deg, var(--bg-from), var(--bg-to));
            color: white;
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background-color: #f8fafc;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid var(--border-color);
        }
        .dark .task-item {
            background-color: #374151;
        }
        .mobile-menu {
            display: none;
        }
        .page-content {
            display: none;
            width: 100%;
            max-width: 100%;
        }
        .page-content.active {
            display: block;
            width: 100%;
            max-width: 100%;
        }
        #main-content-area {
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
        }
        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #d1d5db;
            background-color: white;
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .filter-btn:hover {
            background-color: #f3f4f6;
            border-color: #9ca3af;
        }
        .filter-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .dark .filter-btn {
            background-color: #374151;
            color: #d1d5db;
            border-color: #4b5563;
        }
        .dark .filter-btn:hover {
            background-color: #4b5563;
        }
        .dark .filter-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        @media (max-width: 768px) {
            .desktop-sidebar {
                display: none;
            }
            .mobile-menu {
                display: block;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Authentication Guard - Must be first script -->
    <script>
        (function() {
            // Check authentication status immediately
            function checkAuthenticationStatus() {
                const isLoggedIn = localStorage.getItem('studypal_logged_in') === 'true';
                const userEmail = localStorage.getItem('studypal_user_email');
                const userName = localStorage.getItem('studypal_user_name');
                
                // If not authenticated, show login page immediately
                if (!isLoggedIn || !userEmail) {
                    console.log('🔒 User not authenticated, showing login page');
                    return false;
                }
                
                console.log('✅ User authenticated:', userName, userEmail);
                return true;
            }
            
            // Run authentication check immediately
            const isAuthenticated = checkAuthenticationStatus();
            
            // If not authenticated, ensure login page is shown
            if (!isAuthenticated) {
                // Hide main content immediately
                document.addEventListener('DOMContentLoaded', function() {
                    const loginPage = document.getElementById('loginPage');
                    const mainContent = document.querySelector('.min-h-screen.flex');
                    
                    if (loginPage) {
                        loginPage.style.display = 'flex';
                    }
                    if (mainContent) {
                        mainContent.style.display = 'none';
                    }
                });
                
                // Also apply immediately if elements exist
                setTimeout(function() {
                    const loginPage = document.getElementById('loginPage');
                    const mainContent = document.querySelector('.min-h-screen.flex');
                    
                    if (loginPage) {
                        loginPage.style.display = 'flex';
                    }
                    if (mainContent) {
                        mainContent.style.display = 'none';
                    }
                }, 10);
            }
            
            // Intercept all navigation clicks
            document.addEventListener('click', function(e) {
                const target = e.target.closest('a, button[onclick], [onclick]');
                if (target && !checkAuthenticationStatus()) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Show login page
                    const loginPage = document.getElementById('loginPage');
                    const mainContent = document.querySelector('.min-h-screen.flex');
                    
                    if (loginPage) {
                        loginPage.style.display = 'flex';
                    }
                    if (mainContent) {
                        mainContent.style.display = 'none';
                    }
                    
                    console.log('🔒 Navigation blocked - user not authenticated');
                    return false;
                }
            }, true); // Use capture phase to intercept early
            
            // Monitor localStorage changes
            window.addEventListener('storage', function(e) {
                if (e.key === 'studypal_logged_in' || e.key === 'studypal_user_email') {
                    if (!checkAuthenticationStatus()) {
                        // User logged out, redirect to login
                        const loginPage = document.getElementById('loginPage');
                        const mainContent = document.querySelector('.min-h-screen.flex');
                        
                        if (loginPage) {
                            loginPage.style.display = 'flex';
                        }
                        if (mainContent) {
                            mainContent.style.display = 'none';
                        }
                    }
                }
            });
            
            // Periodic authentication check
            setInterval(function() {
                if (!checkAuthenticationStatus()) {
                    const loginPage = document.getElementById('loginPage');
                    const mainContent = document.querySelector('.min-h-screen.flex');
                    
                    if (loginPage && loginPage.style.display !== 'flex') {
                        loginPage.style.display = 'flex';
                    }
                    if (mainContent && mainContent.style.display !== 'none') {
                        mainContent.style.display = 'none';
                    }
                }
            }, 1000);
        })();
    </script>
    <div id="loginPage" class="min-h-screen flex items-center justify-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div style="background: white; padding: 2.5rem; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 450px; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2);"></div>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <h1 style="color: #667eea; font-size: 2.2rem; margin-bottom: 0.5rem; font-weight: 700;">📚 StudyPal</h1>
                <p style="color: #666; font-size: 0.95rem;">منصة الدراسة الذكية</p>
            </div>
            
            <div id="authSection">
                <div style="display: flex; margin-bottom: 2rem; background: #f8f9fa; border-radius: 10px; padding: 4px;">
                    <div class="auth-tab active" onclick="switchTab('login')" style="flex: 1; padding: 12px; text-align: center; border-radius: 8px; cursor: pointer; transition: all 0.3s; font-weight: 500; color: #667eea; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">تسجيل الدخول</div>
                    <div class="auth-tab" onclick="switchTab('register')" style="flex: 1; padding: 12px; text-align: center; border-radius: 8px; cursor: pointer; transition: all 0.3s; font-weight: 500; color: #666;">حساب جديد</div>
                </div>
                
                <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)" style="display: block;">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500; font-size: 0.9rem;">البريد الإلكتروني</label>
                        <input type="email" id="loginEmail" name="email" required placeholder="أدخل بريدك الإلكتروني" style="width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; transition: all 0.3s; background: #fafbfc; box-sizing: border-box;">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500; font-size: 0.9rem;">كلمة المرور</label>
                        <div style="position: relative;">
                            <input type="password" id="loginPassword" name="password" required placeholder="أدخل كلمة المرور" style="width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; transition: all 0.3s; background: #fafbfc; box-sizing: border-box;">
                            <span onclick="togglePassword('loginPassword')" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; padding: 4px;">👁️</span>
                        </div>
                    </div>
                    
                    <button type="submit" id="loginBtn" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-bottom: 1rem;">
                        <span id="loginBtnText">تسجيل الدخول</span>
                    </button>
                    
                    <div style="text-align: center; margin: 1.5rem 0; position: relative; color: #666; font-size: 0.9rem;">
                        <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #e1e5e9;"></div>
                        <span style="background: white; padding: 0 1rem; position: relative;">أو</span>
                    </div>
                    
                    <button type="button" onclick="signInWithGoogle()" style="width: 100%; padding: 12px; background: white; color: #333; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 1rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        الدخول بحساب Google
                    </button>
                </form>
                
                <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)" style="display: none;">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500; font-size: 0.9rem;">الاسم الكامل</label>
                        <input type="text" id="registerName" name="name" required placeholder="أدخل اسمك الكامل" style="width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; transition: all 0.3s; background: #fafbfc; box-sizing: border-box;">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500; font-size: 0.9rem;">البريد الإلكتروني</label>
                        <input type="email" id="registerEmail" name="email" required placeholder="أدخل بريدك الإلكتروني" style="width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; transition: all 0.3s; background: #fafbfc; box-sizing: border-box;">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500; font-size: 0.9rem;">كلمة المرور</label>
                        <div style="position: relative;">
                            <input type="password" id="registerPassword" name="password" required placeholder="أدخل كلمة مرور قوية" minlength="6" style="width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; transition: all 0.3s; background: #fafbfc; box-sizing: border-box;">
                            <span onclick="togglePassword('registerPassword')" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; padding: 4px;">👁️</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: #333; font-weight: 500; font-size: 0.9rem;">تأكيد كلمة المرور</label>
                        <div style="position: relative;">
                            <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="أعد إدخال كلمة المرور" style="width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; transition: all 0.3s; background: #fafbfc; box-sizing: border-box;">
                            <span onclick="togglePassword('confirmPassword')" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #666; padding: 4px;">👁️</span>
                        </div>
                    </div>
                    
                    <button type="submit" id="registerBtn" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-bottom: 1rem;">
                        <span id="registerBtnText">إنشاء حساب جديد</span>
                    </button>
                    
                    <div style="text-align: center; margin: 1.5rem 0; position: relative; color: #666; font-size: 0.9rem;">
                        <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #e1e5e9;"></div>
                        <span style="background: white; padding: 0 1rem; position: relative;">أو</span>
                    </div>
                    
                    <button type="button" onclick="signUpWithGoogle()" style="width: 100%; padding: 12px; background: white; color: #333; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 1rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        التسجيل بحساب Google
                    </button>
                </form>
                
                <div id="status" style="text-align: center; margin-top: 1rem; padding: 12px; border-radius: 8px; display: none; font-weight: 500;"></div>
            </div>
            
            <div id="welcomeSection" style="display: none; text-align: center;">
                <h2 style="color: #333; margin-bottom: 1rem;">مرحباً بك في StudyPal! 🎉</h2>
                <p style="color: #666; margin-bottom: 2rem;">تم تسجيل دخولك بنجاح</p>
                <p id="userInfo" style="margin-bottom: 2rem;"></p>
                
                <button onclick="goToDashboard()" style="background: #10b981; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 0.5rem; transition: all 0.3s;">
                    🏠 الذهاب إلى لوحة التحكم
                </button>
                
                <button onclick="handleLogout()" style="background: #ef4444; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 0.5rem; transition: all 0.3s;">
                    🚪 تسجيل الخروج
                </button>
            </div>
        </div>
    </div>
                            إنشاء حساب جديد
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen flex">
        <!-- Mobile Menu Button -->
        <div class="mobile-menu fixed top-4 left-4 z-50">
            <button id="mobileMenuBtn" onclick="toggleMobileMenu()" class="p-3 bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>

        <!-- Sidebar -->
        <div class="desktop-sidebar w-72 bg-white dark:bg-gray-800 shadow-xl border-r border-gray-200 dark:border-gray-700">
            <div class="flex flex-col h-full">
                <!-- Logo -->
                <div class="flex items-center justify-center h-20 bg-gradient-to-r from-blue-600 to-blue-700 text-white">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        </div>
                        <h1 class="text-2xl font-bold">StudyPal</h1>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="flex-1 p-6">
                    <nav class="space-y-2">
                        <a href="#" class="nav-link nav-link-active" onclick="handleNavClick(this, 'لوحة التحكم')">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                            </svg>
                            لوحة التحكم
                        </a>
                        <a href="#" class="nav-link nav-link-inactive" onclick="handleNavClick(this, 'إدارة المهام')">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0h2m-2 0v6a2 2 0 002 2h6a2 2 0 002-2v-6a2 2 0 00-2-2h-6z"></path>
                            </svg>
                            إدارة المهام
                        </a>
                        <a href="#" class="nav-link nav-link-inactive" onclick="handleNavClick(this, 'التقويم الدراسي')">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 0h6m-6 0l-2 2m8-2l2 2m-2-2v12a2 2 0 01-2 2H10a2 2 0 01-2-2V9"></path>
                            </svg>
                            التقويم الدراسي
                        </a>
                        <a href="#" class="nav-link nav-link-inactive" onclick="handleNavClick(this, 'الملف الشخصي')">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            الملف الشخصي
                        </a>
                        <a href="#" class="nav-link nav-link-inactive" onclick="handleNavClick(this, 'الدرجات والحضور')">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            الدرجات والحضور
                        </a>
                        <a href="#" class="nav-link nav-link-inactive" onclick="handleNavClick(this, 'الإعدادات')">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            الإعدادات
                        </a>
                    </nav>
                </div>

                <!-- User Profile -->
                <div class="p-6 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                            <span class="text-lg font-bold text-white">أ</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-gray-900 dark:text-gray-200">أحمد محمد</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">ahmed@studypal.com</p>
                        </div>
                    </div>
                    <button id="logoutBtn" class="w-full flex items-center justify-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors" onclick="handleLogout()">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        تسجيل الخروج
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 id="page-title" class="text-2xl font-bold text-gray-900 dark:text-white">لوحة التحكم</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">مرحباً بك في StudyPal - رفيقك في الدراسة</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="darkModeBtn" class="p-2 text-gray-400 hover:text-gray-600 dark:text-gray-300 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors" onclick="toggleDarkMode()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <main id="main-content-area" class="flex-1 p-6 overflow-y-auto bg-gray-50 dark:bg-gray-900">
                <!-- محتوى لوحة التحكم -->
                <div id="dashboard-content" class="page-content active">

              <!-- Stats Cards -->
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card" style="--bg-from: #3b82f6; --bg-to: #1d4ed8;" onclick="handleStatClick('إجمالي المهام', '24')">
                        <div class="relative z-10">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">إجمالي المهام</p>
                                    <p class="text-3xl font-bold text-white mt-2">24</p>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0h2m-2 0v6a2 2 0 002 2h6a2 2 0 002-2v-6a2 2 0 00-2-2h-6z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card" style="--bg-from: #10b981; --bg-to: #059669;" onclick="handleStatClick('المهام المكتملة', '18')">
                        <div class="relative z-10">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">المهام المكتملة</p>
                                    <p class="text-3xl font-bold text-white mt-2">18</p>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card" style="--bg-from: #f59e0b; --bg-to: #d97706;" onclick="handleStatClick('المهام المعلقة', '6')">
                        <div class="relative z-10">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-100 text-sm font-medium">المهام المعلقة</p>
                                    <p class="text-3xl font-bold text-white mt-2">6</p>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card" style="--bg-from: #8b5cf6; --bg-to: #7c3aed;" onclick="handleStatClick('معدل الإنجاز', '75%')">
                        <div class="relative z-10">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm font-medium">معدل الإنجاز</p>
                                    <p class="text-3xl font-bold text-white mt-2">75%</p>
                                </div>
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Tasks -->
                <div class="card mb-8">
                    <div class="p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">المهام الحديثة</h2>
                        <div class="space-y-4">
                            <div class="task-item" style="--border-color: #10b981;" onclick="handleTaskClick('مراجعة الرياضيات', 'مكتملة')">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <div>
                                        <p class="font-semibold text-gray-900">مراجعة الرياضيات</p>
                                        <p class="text-sm text-gray-500">تم الانتهاء منها اليوم</p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">مكتملة</span>
                            </div>

                            <div class="task-item" style="--border-color: #f59e0b;" onclick="handleTaskClick('كتابة التقرير', 'قيد التنفيذ')">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                    <div>
                                        <p class="font-semibold text-gray-900">كتابة التقرير</p>
                                        <p class="text-sm text-gray-500">موعد التسليم: غداً</p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">قيد التنفيذ</span>
                            </div>

                            <div class="task-item" style="--border-color: #ef4444;" onclick="handleTaskClick('مشروع البرمجة', 'عاجل')">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                    <div>
                                        <p class="font-semibold text-gray-900">مشروع البرمجة</p>
                                        <p class="text-sm text-gray-500">موعد التسليم: اليوم</p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full">عاجل</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">إجراءات سريعة</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button class="btn-primary" onclick="showAddTaskModal()">
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                إضافة مهمة جديدة
                            </button>
                            <button class="btn-secondary" onclick="switchToPage('التقويم الدراسي')">
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 0h6m-6 0l-2 2m8-2l2 2m-2-2v12a2 2 0 01-2 2H10a2 2 0 01-2-2V9"></path>
                                </svg>
                                عرض التقويم
                            </button>
                            <button class="btn-secondary" onclick="switchToPage('الملف الشخصي')">
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                عرض الملف الشخصي
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- محتوى صفحة المهام -->
            <div id="tasks-content" class="page-content">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">إدارة المهام</h2>
                        <button class="btn-primary" onclick="showAddTaskModal()">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            إضافة مهمة جديدة
                        </button>
                    </div>
                    
                    <!-- فلاتر المهام -->
                    <div class="flex flex-wrap gap-4 mb-6">
                        <button onclick="filterTasks('all')" class="filter-btn active" data-filter="all">جميع المهام</button>
                        <button onclick="filterTasks('pending')" class="filter-btn" data-filter="pending">قيد التنفيذ</button>
                        <button onclick="filterTasks('completed')" class="filter-btn" data-filter="completed">مكتملة</button>
                        <button onclick="filterTasks('urgent')" class="filter-btn" data-filter="urgent">عاجلة</button>
                        <button onclick="filterTasks('today')" class="filter-btn" data-filter="today">موعدها اليوم</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="task-item" style="--border-color: #ef4444;">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded">
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">مشروع البرمجة</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">موعد التسليم: اليوم</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full">عاجل</span>
                        </div>
                        
                        <div class="task-item" style="--border-color: #f59e0b;">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded">
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">كتابة التقرير</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">موعد التسليم: غداً</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">قيد التنفيذ</span>
                        </div>
                        
                        <div class="task-item" style="--border-color: #10b981;" data-status="completed">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" checked class="w-4 h-4 text-blue-600 rounded" onchange="toggleTaskStatus(this)">
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white line-through">مراجعة الرياضيات</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">تم الانتهاء منها اليوم</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">مكتملة</span>
                        </div>
                        
                        <div class="task-item" style="--border-color: #3b82f6;" data-status="pending" data-priority="medium">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded" onchange="toggleTaskStatus(this)">
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">حضور المحاضرة</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">محاضرة الفيزياء - غداً</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">متوسط</span>
                        </div>
                        
                        <div class="task-item" style="--border-color: #8b5cf6;" data-status="pending" data-priority="low">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded" onchange="toggleTaskStatus(this)">
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">قراءة الكتاب</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">كتاب الأدب - الفصل الثالث</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded-full">منخفض</span>
                        </div>
                        
                        <div class="task-item" style="--border-color: #f59e0b;" data-status="pending" data-priority="medium" data-due="today">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded" onchange="toggleTaskStatus(this)">
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">إعداد العرض التقديمي</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">عرض مشروع التخرج - اليوم</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">متوسط</span>
                        </div>
                        
                        <div class="task-item" style="--border-color: #ef4444;" data-status="pending" data-priority="urgent" data-due="today">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 rounded" onchange="toggleTaskStatus(this)">
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">تسليم الواجب</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">واجب الرياضيات - متأخر!</p>
                                </div>
                            </div>
                            <span class="px-3 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full">عاجل</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- محتوى صفحة التقويم -->
            <div id="calendar-content" class="page-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- التقويم -->
                    <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">التقويم الدراسي</h2>
                            <div class="flex items-center space-x-4">
                                <button onclick="previousMonth()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <span class="text-lg font-semibold text-gray-900 dark:text-white">يناير 2024</span>
                                <button onclick="nextMonth()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-7 gap-2 mb-4">
                            <div class="text-center font-semibold text-gray-700 dark:text-gray-300 p-2">الأحد</div>
                            <div class="text-center font-semibold text-gray-700 dark:text-gray-300 p-2">الاثنين</div>
                            <div class="text-center font-semibold text-gray-700 dark:text-gray-300 p-2">الثلاثاء</div>
                            <div class="text-center font-semibold text-gray-700 dark:text-gray-300 p-2">الأربعاء</div>
                            <div class="text-center font-semibold text-gray-700 dark:text-gray-300 p-2">الخميس</div>
                            <div class="text-center font-semibold text-gray-700 dark:text-gray-300 p-2">الجمعة</div>
                            <div class="text-center font-semibold text-gray-700 dark:text-gray-300 p-2">السبت</div>
                        </div>
                        <div class="grid grid-cols-7 gap-2">
                            <!-- أيام التقويم -->
                            <div class="p-3 text-center text-gray-400">29</div>
                            <div class="p-3 text-center text-gray-400">30</div>
                            <div class="p-3 text-center text-gray-400">31</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(1)">1</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(2)">2</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer relative" onclick="selectDate(3)">
                                3
                                <div class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-blue-500 rounded-full"></div>
                            </div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(4)">4</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer relative" onclick="selectDate(5)">
                                5
                                <div class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-red-500 rounded-full"></div>
                            </div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(6)">6</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(7)">7</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer relative" onclick="selectDate(8)">
                                8
                                <div class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-green-500 rounded-full"></div>
                            </div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(9)">9</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer relative" onclick="selectDate(10)">
                                10
                                <div class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-yellow-500 rounded-full"></div>
                            </div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(11)">11</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer relative" onclick="selectDate(12)">
                                12
                                <div class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-2 h-2 bg-purple-500 rounded-full"></div>
                            </div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(13)">13</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(14)">14</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(15)">15</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(16)">16</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(17)">17</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(18)">18</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(19)">19</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(20)">20</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(21)">21</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(22)">22</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(23)">23</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(24)">24</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(25)">25</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(26)">26</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(27)">27</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(28)">28</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(29)">29</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(30)">30</div>
                            <div class="p-3 text-center hover:bg-blue-50 dark:hover:bg-gray-700 rounded cursor-pointer" onclick="selectDate(31)">31</div>
                            <div class="p-3 text-center text-gray-400">1</div>
                            <div class="p-3 text-center text-gray-400">2</div>
                            <div class="p-3 text-center text-gray-400">3</div>
                        </div>
                    </div>
                    
                    <!-- قائمة الأحداث -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">أحداث هذا الشهر</h3>
                        <div class="space-y-3">
                            <div class="flex items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900/30" onclick="showEventDetails('محاضرة الرياضيات')">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">محاضرة الرياضيات</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">3 يناير - 10:00 ص</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg cursor-pointer hover:bg-red-100 dark:hover:bg-red-900/30" onclick="showEventDetails('امتحان الفيزياء')">
                                <div class="w-3 h-3 bg-red-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">امتحان الفيزياء</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">5 يناير - 2:00 م</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg cursor-pointer hover:bg-green-100 dark:hover:bg-green-900/30" onclick="showEventDetails('مشروع البرمجة')">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">مشروع البرمجة</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">8 يناير - تسليم</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg cursor-pointer hover:bg-yellow-100 dark:hover:bg-yellow-900/30" onclick="showEventDetails('عرض تقديمي')">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">عرض تقديمي</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">10 يناير - 11:30 ص</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg cursor-pointer hover:bg-purple-100 dark:hover:bg-purple-900/30" onclick="showEventDetails('اجتماع المجموعة')">
                                <div class="w-3 h-3 bg-purple-500 rounded-full mr-3"></div>
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white">اجتماع المجموعة</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">12 يناير - 4:00 م</p>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="addNewEvent()" class="w-full mt-4 btn-primary">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            إضافة حدث جديد
                        </button>
                    </div>
                </div>
            </div>

            <!-- محتوى صفحة الملف الشخصي -->
            <div id="profile-content" class="page-content">
                <!-- معلومات الطالب الأساسية -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
                    <div class="flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6">
                        <!-- صورة الملف الشخصي -->
                        <div class="flex flex-col items-center">
                            <div class="relative">
                                <div id="profile-photo" class="w-32 h-32 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-4xl font-bold text-white">
                                    أ
                                </div>
                                <button onclick="changeProfilePhoto()" class="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 002 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h2.93a2 2 0 001.664.89l.812 1.22A2 2 0 0010.07 11H7a2 2 0 01-2-2V3z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                </button>
                            </div>
                            <input type="file" id="photo-upload" accept="image/*" class="hidden" onchange="handlePhotoUpload(this)">
                        </div>
                        
                        <!-- معلومات الطالب -->
                        <div class="flex-1 w-full">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الاسم الكامل</label>
                                    <input id="student-name" type="text" value="أحمد محمد علي" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">رقم الطالب</label>
                                    <input id="student-id" type="text" value="2021001234" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الجامعة</label>
                                    <input id="university" type="text" value="جامعة القاهرة" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الكلية</label>
                                    <input id="college" type="text" value="كلية الحاسبات والمعلومات" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">التخصص</label>
                                    <input id="major" type="text" value="علوم الحاسوب" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">المستوى الدراسي</label>
                                    <select id="academic-level" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                        <option value="1">المستوى الأول</option>
                                        <option value="2">المستوى الثاني</option>
                                        <option value="3">المستوى الثالث</option>
                                        <option value="4" selected>المستوى الرابع</option>
                                        <option value="5">المستوى الخامس</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">البريد الإلكتروني</label>
                                    <input id="email" type="email" value="ahmed@studypal.com" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">رقم الهاتف</label>
                                    <input id="phone" type="tel" value="+20 123 456 7890" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button onclick="saveStudentProfile()" class="btn-primary">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            حفظ المعلومات
                        </button>
                    </div>
                </div>
                
                <!-- إحصائيات الأداء الأكاديمي -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-green-400 via-green-500 to-green-600 rounded-2xl p-8 text-white card-hover transform transition-all duration-300 hover:scale-105">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-lg font-medium">🏆 المعدل التراكمي</p>
                                <p class="text-4xl font-bold mt-2" id="profile-cumulative-gpa">3.75</p>
                                <p class="text-green-200 mt-1">من 4.0</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-4">
                                <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-400 via-blue-500 to-blue-600 rounded-2xl p-8 text-white card-hover transform transition-all duration-300 hover:scale-105">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-lg font-medium">📚 معدل الفصل الحالي</p>
                                <p class="text-4xl font-bold mt-2" id="current-semester-gpa">3.85</p>
                                <p class="text-blue-200 mt-1">من 4.0</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-4">
                                <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                        
                    <div class="bg-gradient-to-br from-purple-400 via-purple-500 to-purple-600 rounded-2xl p-8 text-white card-hover transform transition-all duration-300 hover:scale-105">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-lg font-medium">⏰ الساعات المكتملة</p>
                                <p class="text-4xl font-bold mt-2" id="completed-hours">95</p>
                                <p class="text-purple-200 mt-1">من 130 ساعة</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full p-4">
                                <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- أزرار الإجراءات -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
                    <div class="flex flex-wrap gap-4">
                        <button onclick="showAddSubjectModal()" class="btn-primary">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            إضافة مادة جديدة
                        </button>
                        <button onclick="calculateGPA()" class="btn-secondary">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            حساب المعدل
                        </button>
                        <button onclick="exportGrades()" class="btn-outline">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            تصدير الدرجات
                        </button>
                    </div>
                </div>
                
                <!-- المواد الحالية -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden mb-6">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">المواد الحالية - الفصل الدراسي الحالي</h3>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">اسم المادة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الساعات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الدرجة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التقدير</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحضور</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحالة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="current-subjects-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- المواد الحالية -->
                                <tr class="subject-row" data-status="current">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">قواعد البيانات</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">CS302</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">3</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="number" value="85" min="0" max="100" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white" onchange="updateGrade(this)">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">B+</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 82%"></div>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">82%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">جارية</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="openCourseTracking('CS302')" class="text-purple-600 hover:text-purple-900 ml-2">متابعة</button>
                                        <button onclick="addAttendance(this)" class="text-green-600 hover:text-green-900 ml-2">حضور</button>
                                        <button onclick="viewDetails(this)" class="text-blue-600 hover:text-blue-900">تفاصيل</button>
                                    </td>
                                </tr>
                                
                                <tr class="subject-row" data-status="current">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">الذكاء الاصطناعي</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">CS450</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">3</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="number" value="90" min="0" max="100" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white" onchange="updateGrade(this)">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">A-</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                                                <div class="bg-green-600 h-2 rounded-full" style="width: 88%"></div>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">88%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">مكتملة</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editSubject(this)" class="text-blue-600 hover:text-blue-900 ml-2">تعديل</button>
                                        <button onclick="viewDetails(this)" class="text-green-600 hover:text-green-900">التفاصيل</button>
                                    </td>
                                </tr>
                                
                                <!-- المواد الحالية -->
                                <tr class="subject-row" data-status="current">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">قواعد البيانات</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">CS302</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">3</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="number" value="85" min="0" max="100" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white" onchange="updateGrade(this)">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">B+</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 82%"></div>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">82%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">جارية</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editSubject(this)" class="text-blue-600 hover:text-blue-900 ml-2">تعديل</button>
                                        <button onclick="addAttendance(this)" class="text-purple-600 hover:text-purple-900 ml-2">حضور</button>
                                        <button onclick="viewDetails(this)" class="text-green-600 hover:text-green-900">التفاصيل</button>
                                    </td>
                                </tr>
                                
                                <tr class="subject-row" data-status="current">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">الذكاء الاصطناعي</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">CS450</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">3</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="number" value="90" min="0" max="100" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white" onchange="updateGrade(this)">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">A-</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                                                <div class="bg-green-600 h-2 rounded-full" style="width: 88%"></div>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">88%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">جارية</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editSubject(this)" class="text-blue-600 hover:text-blue-900 ml-2">تعديل</button>
                                        <button onclick="addAttendance(this)" class="text-purple-600 hover:text-purple-900 ml-2">حضور</button>
                                        <button onclick="viewDetails(this)" class="text-green-600 hover:text-green-900">التفاصيل</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- المواد المكتملة -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">المواد المكتملة - الفصول السابقة</h3>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">اسم المادة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الساعات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الدرجة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التقدير</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحضور</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحالة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="completed-subjects-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- المواد المكتملة -->
                                <tr class="subject-row" data-status="completed">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">الرياضيات المتقدمة</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">MATH301</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">3</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">88</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">A-</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                                                <div class="bg-green-600 h-2 rounded-full" style="width: 95%"></div>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">95%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">مكتملة</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="viewDetails(this)" class="text-blue-600 hover:text-blue-900">تفاصيل</button>
                                    </td>
                                </tr>
                                
                                <tr class="subject-row" data-status="completed">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">البرمجة المتقدمة</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">CS401</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">4</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="text-sm font-medium text-gray-900 dark:text-white">92</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">A</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="w-16 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                                                <div class="bg-green-600 h-2 rounded-full" style="width: 98%"></div>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">98%</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">مكتملة</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="viewDetails(this)" class="text-blue-600 hover:text-blue-900">تفاصيل</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- صفحة متابعة المادة -->
            <div id="course-tracking-content" class="page-content" style="display: none;">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white" id="course-tracking-title">متابعة مادة: قواعد البيانات</h2>
                            <p class="text-gray-600 dark:text-gray-400" id="course-tracking-code">CS302</p>
                        </div>
                        <button onclick="switchToPage('الدرجات والحضور')" class="btn-secondary">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            عودة
                        </button>
                    </div>
                    
                    <!-- إحصائيات المادة -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white">
                            <div class="text-center">
                                <p class="text-blue-100">عدد المحاضرات</p>
                                <p class="text-2xl font-bold" id="total-lectures">16</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 text-white">
                            <div class="text-center">
                                <p class="text-green-100">الحضور</p>
                                <p class="text-2xl font-bold" id="attended-lectures">13</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-lg p-4 text-white">
                            <div class="text-center">
                                <p class="text-yellow-100">نسبة الحضور</p>
                                <p class="text-2xl font-bold" id="attendance-percentage">81%</p>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 text-white">
                            <div class="text-center">
                                <p class="text-purple-100">الدرجة الحالية</p>
                                <p class="text-2xl font-bold" id="current-grade">85</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- جدول المحاضرات -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden mb-6">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">سجل الحضور والمحاضرات</h3>
                            <button onclick="addNewLecture()" class="btn-primary">
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                إضافة محاضرة
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">التاريخ</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">عنوان المحاضرة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الحضور</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">الدرجة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ملاحظات</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="lectures-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- محاضرات نموذجية -->
                                <tr class="lecture-row">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">2024/01/15</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">مقدمة في قواعد البيانات</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">حاضر</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="number" value="8" min="0" max="10" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">مشاركة جيدة</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editLecture(this)" class="text-blue-600 hover:text-blue-900 ml-2">تعديل</button>
                                        <button onclick="deleteLecture(this)" class="text-red-600 hover:text-red-900">حذف</button>
                                    </td>
                                </tr>
                                
                                <tr class="lecture-row">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">2024/01/17</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">SQL الأساسي</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full">غائب</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="number" value="0" min="0" max="10" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">غياب بعذر</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editLecture(this)" class="text-blue-600 hover:text-blue-900 ml-2">تعديل</button>
                                        <button onclick="deleteLecture(this)" class="text-red-600 hover:text-red-900">حذف</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            </main>
            
            <!-- Settings Content -->
            <div id="settings-content" class="page-content" style="display: none;">
                <div class="space-y-8">
                    <!-- Profile Settings -->
                    <div class="card p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center">
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            الملف الشخصي
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الاسم الكامل</label>
                                <input type="text" id="user-name" placeholder="أدخل اسمك الكامل" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">البريد الإلكتروني</label>
                                <input type="email" id="user-email" placeholder="example@domain.com" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">رقم الهاتف</label>
                                <input type="tel" id="user-phone" placeholder="+966 50 123 4567" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">التخصص</label>
                                <select id="user-major" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="">اختر التخصص</option>
                                    <option value="computer-science">علوم الحاسب</option>
                                    <option value="software-engineering">هندسة البرمجيات</option>
                                    <option value="information-systems">نظم المعلومات</option>
                                    <option value="cybersecurity">الأمن السيبراني</option>
                                    <option value="data-science">علوم البيانات</option>
                                    <option value="artificial-intelligence">الذكاء الاصطناعي</option>
                                    <option value="business-administration">إدارة الأعمال</option>
                                    <option value="accounting">المحاسبة</option>
                                    <option value="marketing">التسويق</option>
                                    <option value="medicine">الطب</option>
                                    <option value="engineering">الهندسة</option>
                                    <option value="law">القانون</option>
                                    <option value="education">التعليم</option>
                                    <option value="other">أخرى</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <button onclick="saveProfile()" class="btn-primary">
                                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                حفظ الملف الشخصي
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- نافذة إضافة مهمة جديدة -->
        <div id="addTaskModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">إضافة مهمة جديدة</h3>
                        <button onclick="hideAddTaskModal()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <form id="add-task-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">عنوان المهمة</label>
                            <input id="task-title" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="أدخل عنوان المهمة">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الوصف</label>
                            <textarea id="task-description" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" rows="3" placeholder="وصف المهمة (اختياري)"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الأولوية</label>
                                <select id="task-priority" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="منخفض">منخفض</option>
                                    <option value="متوسط" selected>متوسط</option>
                                    <option value="عاجل">عاجل</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">تاريخ التسليم</label>
                                <input id="task-due-date" type="date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        <div class="flex space-x-3 pt-4">
                            <button type="button" onclick="addNewTask()" class="btn-primary flex-1">إضافة المهمة</button>
                            <button type="button" onclick="hideAddTaskModal()" class="btn-secondary">إلغاء</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- نافذة إضافة مادة جديدة -->
        <div id="addSubjectModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">إضافة مادة جديدة</h3>
                        <button onclick="hideAddSubjectModal()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <form id="add-subject-form" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">اسم المادة</label>
                                <input id="subject-name" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="مثل: الرياضيات">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">رمز المادة</label>
                                <input id="subject-code" type="text" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="مثل: MATH101">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">عدد الساعات</label>
                                <select id="subject-hours" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="1">1 ساعة</option>
                                    <option value="2">2 ساعة</option>
                                    <option value="3" selected>3 ساعات</option>
                                    <option value="4">4 ساعات</option>
                                    <option value="5">5 ساعات</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">حالة المادة</label>
                                <select id="subject-status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="current">جارية</option>
                                    <option value="completed">مكتملة</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الدرجة (من 100)</label>
                            <input id="subject-grade" type="number" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="85">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">نسبة الحضور (%)</label>
                            <input id="subject-attendance" type="number" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="90">
                        </div>
                        
                        <div class="flex space-x-3 pt-4">
                            <button type="button" onclick="addNewSubject()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">إضافة</button>
                            <button type="button" onclick="hideAddSubjectModal()" class="flex-1 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors">إلغاء</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global functions that can be called from HTML
        function toggleDarkMode() {
            console.log('Toggling dark mode...');
            document.documentElement.classList.toggle('dark');
            document.body.classList.toggle('bg-gray-900');
            document.body.classList.toggle('bg-gray-50');
            
            // Update button icon
            const darkModeBtn = document.querySelector('#darkModeBtn');
            if (darkModeBtn) {
                const icon = darkModeBtn.querySelector('svg');
                if (document.documentElement.classList.contains('dark')) {
                    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>';
                } else {
                    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>';
                }
            }
            showNotification('تم تغيير الوضع بنجاح!');
        }

        function toggleMobileMenu() {
            console.log('Toggling mobile menu...');
            const sidebar = document.querySelector('.desktop-sidebar');
            if (sidebar) {
                sidebar.classList.toggle('hidden');
                showNotification('تم تبديل القائمة');
            }
        }

        function showNotification(message, type = 'success') {
            // إزالة الإشعارات السابقة
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white ${
                type === 'error' ? 'bg-red-500' : 'bg-green-500'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function handleNavClick(element, pageName) {
            console.log(`🔄 تبديل إلى صفحة: ${pageName}`);
            
            // إزالة الكلاس النشط من جميع الروابط
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('nav-link-active');
                link.classList.add('nav-link-inactive');
            });
            
            // إضافة الكلاس النشط للرابط المحدد
            element.classList.add('nav-link-active');
            element.classList.remove('nav-link-inactive');
            
            // تحديث العنوان
            document.getElementById('page-title').textContent = pageName;
            
            // إخفاء جميع المحتويات
            document.querySelectorAll('.page-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // إظهار المحتوى المناسب
            let targetId = '';
            switch(pageName) {
                case 'لوحة التحكم':
                    targetId = 'dashboard-content';
                    break;
                case 'إدارة المهام':
                    targetId = 'tasks-content';
                    break;
                case 'التقويم الدراسي':
                    targetId = 'calendar-content';
                    break;
                case 'الدرجات والحضور':
                    targetId = 'grades-content';
                    break;
                case 'الملف الشخصي':
                    targetId = 'profile-content';
                    break;
                case 'الإعدادات':
                    targetId = 'settings-content';
                    break;
            }
            
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
                targetContent.style.display = 'block';
                console.log(`✅ تم عرض محتوى: ${targetId}`);
                
                // تحميل البيانات المحفوظة عند الانتقال للإعدادات أو الملف الشخصي
                if (pageName === 'الإعدادات' || pageName === 'الملف الشخصي') {
                    console.log('📥 تحميل البيانات المحفوظة للصفحة...');
                    ensureDataLoaded();
                }
            } else {
                console.warn(`❌ لم يتم العثور على محتوى: ${targetId}`);
                // إضافة الصفحات المفقودة
                addMissingPages();
                setTimeout(() => {
                    const retryContent = document.getElementById(targetId);
                    if (retryContent) {
                        retryContent.style.display = 'block';
                        console.log(`✅ تم عرض محتوى بعد الإضافة: ${targetId}`);
                        if (pageName === 'الإعدادات' || pageName === 'الملف الشخصي') {
                            ensureDataLoaded();
                        }
                    }
                }, 500);
            }
            
            // Update page title
            const pageTitle = document.getElementById('page-title');
            if (pageTitle) {
                pageTitle.textContent = pageName;
            }
            
            showNotification(`تم الانتقال إلى ${pageName}`);
            return false; // Prevent default link behavior
        }

        function showAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            if (modal) {
                modal.classList.remove('hidden');
                showNotification('فتح نافذة إضافة مهمة جديدة');
            }
        }

        function hideAddTaskModal() {
            const modal = document.getElementById('addTaskModal');
            if (modal) {
                modal.classList.add('hidden');
                showNotification('تم إغلاق النافذة');
            }
        }

        function addNewTask() {
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const priority = document.getElementById('task-priority').value;
            const dueDate = document.getElementById('task-due-date').value;
            
            if (!title.trim()) {
                showNotification('يرجى إدخال عنوان المهمة', 'error');
                return;
            }
            
            // إضافة المهمة للواجهة
            const tasksContainer = document.querySelector('#tasks-content .space-y-4');
            const newTask = document.createElement('div');
            
            const priorityColors = {
                'عاجل': '#ef4444',
                'متوسط': '#f59e0b', 
                'منخفض': '#10b981'
            };
            
            const priorityBgColors = {
                'عاجل': 'bg-red-100 text-red-800',
                'متوسط': 'bg-yellow-100 text-yellow-800',
                'منخفض': 'bg-green-100 text-green-800'
            };
            
            newTask.className = 'task-item';
            newTask.style.setProperty('--border-color', priorityColors[priority] || '#10b981');
            newTask.innerHTML = `
                <div class="flex items-center space-x-3">
                    <input type="checkbox" class="w-4 h-4 text-blue-600 rounded">
                    <div>
                        <p class="font-semibold text-gray-900 dark:text-white">${title}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${description}</p>
                        ${dueDate ? `<p class="text-xs text-gray-400">موعد التسليم: ${dueDate}</p>` : ''}
                    </div>
                </div>
                <span class="px-3 py-1 ${priorityBgColors[priority] || 'bg-green-100 text-green-800'} text-xs font-medium rounded-full">${priority}</span>
            `;
            
            tasksContainer.appendChild(newTask);
            
            // إعادة تعيين النموذج
            document.getElementById('add-task-form').reset();
            hideAddTaskModal();
            showNotification('تم إضافة المهمة بنجاح!');
        }

        function switchToPage(pageName) {
            // العثور على الرابط المناسب والضغط عليه
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                if (link.textContent.trim() === pageName) {
                    handleNavClick(link, pageName);
                }
            });
        }

        function saveProfile() {
            const name = document.getElementById('user-name').value;
            const email = document.getElementById('user-email').value;
            const phone = document.getElementById('user-phone').value;
            const major = document.getElementById('user-major').value;
            
            if (!name.trim() || !email.trim()) {
                showNotification('يرجى ملء جميع الحقول المطلوبة', 'error');
                return;
            }
            
            // حفظ في localStorage للجلسة الحالية
            localStorage.setItem('studypal_user_name', name);
            localStorage.setItem('studypal_user_email', email);
            localStorage.setItem('studypal_user_phone', phone);
            localStorage.setItem('studypal_user_major', major);
            
            // تحديث اسم المستخدم في الشريط الجانبي
            const userNameElement = document.querySelector('.sidebar .text-sm.font-medium');
            if (userNameElement) {
                userNameElement.textContent = name;
            }
            
            // تحديث الإيميل في الشريط الجانبي
            const userEmailElement = document.querySelector('.sidebar .text-xs.text-gray-500');
            if (userEmailElement) {
                userEmailElement.textContent = email;
            }
            
            showNotification('تم حفظ الملف الشخصي بنجاح! (محفوظ في الجلسة الحالية)');
        }
        
        // تحميل البيانات المحفوظة عند تحميل الصفحة
        function loadSavedData() {
            const savedName = localStorage.getItem('studypal_user_name');
            const savedEmail = localStorage.getItem('studypal_user_email');
            const savedPhone = localStorage.getItem('studypal_user_phone');
            const savedMajor = localStorage.getItem('studypal_user_major');
            
            if (savedName) {
                const nameInput = document.getElementById('user-name');
                if (nameInput) nameInput.value = savedName;
                
                const sidebarName = document.querySelector('.sidebar .text-sm.font-medium');
                if (sidebarName) sidebarName.textContent = savedName;
            }
            
            if (savedEmail) {
                const emailInput = document.getElementById('user-email');
                if (emailInput) emailInput.value = savedEmail;
                
                const sidebarEmail = document.querySelector('.sidebar .text-xs.text-gray-500');
                if (sidebarEmail) sidebarEmail.textContent = savedEmail;
            }
            
            if (savedPhone) {
                const phoneInput = document.getElementById('user-phone');
                if (phoneInput) phoneInput.value = savedPhone;
            }
            
            if (savedMajor) {
                const majorInput = document.getElementById('user-major');
                if (majorInput) majorInput.value = savedMajor;
            }
            
            // تحميل بيانات الملف الشخصي
            loadStudentProfile();
        }

        function toggleSetting(settingName, isEnabled) {
            const status = isEnabled ? 'تم تفعيل' : 'تم إلغاء';
            const settingNames = {
                'notifications': 'الإشعارات',
                'reminders': 'تذكيرات المهام',
                'sound': 'الإشعارات الصوتية'
            };
            showNotification(`${status} ${settingNames[settingName]}`);
        }

        function updateReminderTime(minutes) {
            const timeNames = {
                '15': '15 دقيقة',
                '30': '30 دقيقة', 
                '60': 'ساعة',
                '120': 'ساعتين',
                '1440': 'يوم'
            };
            showNotification(`تم تحديث وقت التذكير إلى ${timeNames[minutes]} قبل الموعد`);
        }

        function changeLanguage(lang) {
            const langNames = {
                'ar': 'العربية',
                'en': 'الإنجليزية'
            };
            showNotification(`تم تغيير اللغة إلى ${langNames[lang]}`);
        }

        function changePassword() {
            showNotification('سيتم فتح نافذة تغيير كلمة المرور قريباً');
        }

        function exportData() {
            showNotification('جاري تصدير البيانات... سيتم التحميل قريباً');
        }

        function deleteAccount() {
            if (confirm('هل أنت متأكد من حذف حسابك؟ هذا الإجراء لا يمكن التراجع عنه.')) {
                showNotification('تم إرسال طلب حذف الحساب', 'error');
            }
        }

        function checkUpdates() {
            showNotification('التطبيق محدث إلى أحدث إصدار!');
        }

        function contactSupport() {
            showNotification('سيتم فتح نافذة التواصل مع الدعم قريباً');
        }

        function showAbout() {
            showNotification('StudyPal v1.0.0 - تطبيق إدارة الدراسة الذكي');
        }

        // وظائف التقويم
        function selectDate(day) {
            showNotification(`تم اختيار يوم ${day} يناير`);
        }

        function previousMonth() {
            showNotification('الانتقال إلى الشهر السابق');
        }

        function nextMonth() {
            showNotification('الانتقال إلى الشهر التالي');
        }

        function showEventDetails(eventName) {
            showNotification(`تفاصيل الحدث: ${eventName}`);
        }

        function addNewEvent() {
            showNotification('سيتم فتح نافذة إضافة حدث جديد');
        }

        // وظائف المهام
        function filterTasks(filter) {
            // إزالة active class من جميع الفلاتر
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // إضافة active class للفلتر المختار
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
            
            // فلترة المهام
            const tasks = document.querySelectorAll('.task-item');
            tasks.forEach(task => {
                let show = false;
                
                switch(filter) {
                    case 'all':
                        show = true;
                        break;
                    case 'pending':
                        show = task.dataset.status === 'pending';
                        break;
                    case 'completed':
                        show = task.dataset.status === 'completed';
                        break;
                    case 'urgent':
                        show = task.dataset.priority === 'urgent';
                        break;
                    case 'today':
                        show = task.dataset.due === 'today';
                        break;
                }
                
                task.style.display = show ? 'flex' : 'none';
            });
            
            const filterNames = {
                'all': 'جميع المهام',
                'pending': 'المهام قيد التنفيذ',
                'completed': 'المهام المكتملة',
                'urgent': 'المهام العاجلة',
                'today': 'مهام اليوم'
            };
            
            showNotification(`تم عرض ${filterNames[filter]}`);
        }

        function toggleTaskStatus(checkbox) {
            const taskItem = checkbox.closest('.task-item');
            const taskTitle = taskItem.querySelector('p.font-semibold');
            const statusBadge = taskItem.querySelector('span');
            
            if (checkbox.checked) {
                taskTitle.classList.add('line-through');
                taskItem.dataset.status = 'completed';
                statusBadge.className = 'px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full';
                statusBadge.textContent = 'مكتملة';
                showNotification('تم إنجاز المهمة! أحسنت العمل 🎉');
            } else {
                taskTitle.classList.remove('line-through');
                taskItem.dataset.status = 'pending';
                statusBadge.className = 'px-3 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full';
                statusBadge.textContent = 'قيد التنفيذ';
                showNotification('تم إعادة فتح المهمة');
            }
        }

        // وظائف الدرجات والحضور
        function showAddSubjectModal() {
            document.getElementById('addSubjectModal').classList.remove('hidden');
        }

        function hideAddSubjectModal() {
            document.getElementById('addSubjectModal').classList.add('hidden');
            document.getElementById('add-subject-form').reset();
        }

        function addNewSubject() {
            const name = document.getElementById('subject-name').value;
            const code = document.getElementById('subject-code').value;
            const hours = document.getElementById('subject-hours').value;
            const status = document.getElementById('subject-status').value;
            const grade = document.getElementById('subject-grade').value || 0;
            const attendance = document.getElementById('subject-attendance').value || 0;
            
            if (!name || !code) {
                showNotification('يرجى إدخال اسم المادة ورمزها');
                return;
            }
            
            const gradeText = getGradeText(grade);
            const statusText = status === 'completed' ? 'مكتملة' : 'جارية';
            const statusClass = status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800';
            const attendanceColor = attendance >= 90 ? 'bg-green-600' : attendance >= 75 ? 'bg-yellow-500' : 'bg-red-500';
            
            const newRow = `
                <tr class="subject-row" data-status="${status}">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900 dark:text-white">${name}</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">${code}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${hours}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="number" value="${grade}" min="0" max="100" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white" onchange="updateGrade(this)">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold bg-${gradeText.color}-100 text-${gradeText.color}-800 rounded-full">${gradeText.text}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-200 rounded-full h-2 dark:bg-gray-700">
                                <div class="${attendanceColor} h-2 rounded-full" style="width: ${attendance}%"></div>
                            </div>
                            <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">${attendance}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold ${statusClass} rounded-full">${statusText}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editSubject(this)" class="text-blue-600 hover:text-blue-900 ml-2">تعديل</button>
                        ${status === 'current' ? '<button onclick="addAttendance(this)" class="text-purple-600 hover:text-purple-900 ml-2">حضور</button>' : ''}
                        <button onclick="viewDetails(this)" class="text-green-600 hover:text-green-900">التفاصيل</button>
                    </td>
                </tr>
            `;
            
            document.getElementById('subjects-table').insertAdjacentHTML('beforeend', newRow);
            hideAddSubjectModal();
            calculateGPA();
            showNotification(`تم إضافة مادة ${name} بنجاح!`);
        }

        function getGradeText(grade) {
            if (grade >= 95) return { text: 'A+', color: 'green' };
            if (grade >= 90) return { text: 'A', color: 'green' };
            if (grade >= 85) return { text: 'A-', color: 'green' };
            if (grade >= 80) return { text: 'B+', color: 'blue' };
            if (grade >= 75) return { text: 'B', color: 'blue' };
            if (grade >= 70) return { text: 'B-', color: 'blue' };
            if (grade >= 65) return { text: 'C+', color: 'yellow' };
            if (grade >= 60) return { text: 'C', color: 'yellow' };
            if (grade >= 50) return { text: 'D', color: 'orange' };
            return { text: 'F', color: 'red' };
        }

        function updateGrade(input) {
            const grade = parseFloat(input.value) || 0;
            const row = input.closest('tr');
            const gradeText = getGradeText(grade);
            const gradeBadge = row.querySelector('td:nth-child(4) span');
            
            gradeBadge.className = `px-2 py-1 text-xs font-semibold bg-${gradeText.color}-100 text-${gradeText.color}-800 rounded-full`;
            gradeBadge.textContent = gradeText.text;
            
            calculateGPA();
            showNotification('تم تحديث الدرجة وإعادة حساب المعدل');
        }

        function calculateGPA() {
            const rows = document.querySelectorAll('.subject-row');
            let totalPoints = 0;
            let totalHours = 0;
            let currentSemesterPoints = 0;
            let currentSemesterHours = 0;
            let completedHours = 0;
            
            rows.forEach(row => {
                const hours = parseInt(row.querySelector('td:nth-child(2)').textContent);
                const grade = parseFloat(row.querySelector('input[type="number"]').value) || 0;
                const status = row.dataset.status;
                
                const points = getGradePoints(grade);
                
                totalPoints += points * hours;
                totalHours += hours;
                
                if (status === 'current') {
                    currentSemesterPoints += points * hours;
                    currentSemesterHours += hours;
                } else if (status === 'completed') {
                    completedHours += hours;
                }
            });
            
            const cumulativeGPA = totalHours > 0 ? (totalPoints / totalHours).toFixed(2) : '0.00';
            const currentGPA = currentSemesterHours > 0 ? (currentSemesterPoints / currentSemesterHours).toFixed(2) : '0.00';
            
            document.getElementById('cumulative-gpa').textContent = cumulativeGPA;
            document.getElementById('current-semester-gpa').textContent = currentGPA;
            document.getElementById('completed-hours').textContent = completedHours;
        }

        function getGradePoints(grade) {
            if (grade >= 95) return 4.0;
            if (grade >= 90) return 3.7;
            if (grade >= 85) return 3.3;
            if (grade >= 80) return 3.0;
            if (grade >= 75) return 2.7;
            if (grade >= 70) return 2.3;
            if (grade >= 65) return 2.0;
            if (grade >= 60) return 1.7;
            if (grade >= 50) return 1.0;
            return 0.0;
        }

        function editSubject(button) {
            const row = button.closest('tr');
            const subjectName = row.querySelector('.text-sm.font-medium').textContent;
            const subjectCode = row.querySelector('.text-sm.text-gray-500').textContent;
            const hours = row.querySelector('td:nth-child(2)').textContent;
            const currentGrade = row.querySelector('input[type="number"]').value;
            
            // ملء نموذج التعديل بالبيانات الحالية
            document.getElementById('subject-name').value = subjectName;
            document.getElementById('subject-code').value = subjectCode;
            document.getElementById('subject-hours').value = hours;
            document.getElementById('subject-grade').value = currentGrade;
            
            // فتح نافذة التعديل
            showAddSubjectModal();
            showNotification(`تعديل مادة: ${subjectName}`);
        }

        function addAttendance(button) {
            const row = button.closest('tr');
            const subjectName = row.querySelector('.text-sm.font-medium').textContent;
            const currentAttendance = Math.floor(Math.random() * 20) + 80; // رقم عشوائي بين 80-100
            
            // تحديث شريط الحضور
            const attendanceBar = row.querySelector('.bg-yellow-500, .bg-green-600, .bg-red-500');
            const attendanceText = row.querySelector('td:nth-child(5) span');
            
            if (attendanceBar && attendanceText) {
                attendanceBar.style.width = currentAttendance + '%';
                attendanceText.textContent = currentAttendance + '%';
                
                // تغيير لون الشريط حسب النسبة
                attendanceBar.className = attendanceBar.className.replace(/bg-(green|yellow|red)-\d+/, '');
                if (currentAttendance >= 90) {
                    attendanceBar.classList.add('bg-green-600');
                } else if (currentAttendance >= 75) {
                    attendanceBar.classList.add('bg-yellow-500');
                } else {
                    attendanceBar.classList.add('bg-red-500');
                }
            }
            
            showNotification(`تم تحديث حضور ${subjectName} إلى ${currentAttendance}%`);
        }

        function viewDetails(button) {
            const row = button.closest('tr');
            const subjectName = row.querySelector('.text-sm.font-medium').textContent;
            const subjectCode = row.querySelector('.text-sm.text-gray-500').textContent;
            const hours = row.querySelector('td:nth-child(2)').textContent;
            const grade = row.querySelector('input[type="number"]').value;
            const gradeText = row.querySelector('td:nth-child(4) span').textContent;
            const attendance = row.querySelector('td:nth-child(5) span').textContent;
            const status = row.querySelector('td:nth-child(6) span').textContent;
            
            // عرض تفاصيل المادة في إشعار
            const details = `
تفاصيل المادة:
الاسم: ${subjectName}
الرمز: ${subjectCode}
الساعات: ${hours}
الدرجة: ${grade}/100
التقدير: ${gradeText}
الحضور: ${attendance}
الحالة: ${status}`;
            
            alert(details);
            showNotification(`عرض تفاصيل مادة: ${subjectName}`);
        }

        function exportGrades() {
            showNotification('سيتم تصدير الدرجات إلى ملف Excel');
        }

        // وظائف متابعة المادة
        function openCourseTracking(courseCode) {
            const courseName = {
                'CS302': 'قواعد البيانات',
                'CS450': 'الذكاء الاصطناعي',
                'MATH301': 'الرياضيات المتقدمة'
            };
            
            document.getElementById('course-tracking-title').textContent = `متابعة مادة: ${courseName[courseCode] || courseCode}`;
            document.getElementById('course-tracking-code').textContent = courseCode;
            
            switchToPage('course-tracking');
            showNotification(`تم فتح صفحة متابعة مادة ${courseName[courseCode] || courseCode}`);
        }

        function addNewLecture() {
            const today = new Date().toISOString().split('T')[0].replace(/-/g, '/');
            const newRow = `
                <tr class="lecture-row">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">${today}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="text" placeholder="عنوان المحاضرة" class="w-full px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <select class="px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">
                            <option value="حاضر">حاضر</option>
                            <option value="غائب">غائب</option>
                        </select>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="number" value="0" min="0" max="10" class="w-16 px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="text" placeholder="ملاحظات" class="w-full px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="saveLecture(this)" class="text-green-600 hover:text-green-900 ml-2">حفظ</button>
                        <button onclick="deleteLecture(this)" class="text-red-600 hover:text-red-900">حذف</button>
                    </td>
                </tr>
            `;
            
            document.getElementById('lectures-table').insertAdjacentHTML('beforeend', newRow);
            showNotification('تم إضافة محاضرة جديدة');
        }

        function saveLecture(button) {
            const row = button.closest('tr');
            const titleInput = row.querySelector('input[type="text"]');
            const attendanceSelect = row.querySelector('select');
            const gradeInput = row.querySelector('input[type="number"]');
            const notesInput = row.querySelectorAll('input[type="text"]')[1];
            
            if (!titleInput.value.trim()) {
                showNotification('يرجى إدخال عنوان المحاضرة', 'error');
                return;
            }
            
            // تحويل الحقول إلى نص عادي
            const titleCell = row.children[1];
            titleCell.innerHTML = `<div class="text-sm font-medium text-gray-900 dark:text-white">${titleInput.value}</div>`;
            
            const attendanceCell = row.children[2];
            const attendanceValue = attendanceSelect.value;
            const attendanceClass = attendanceValue === 'حاضر' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
            attendanceCell.innerHTML = `<span class="px-2 py-1 text-xs font-semibold ${attendanceClass} rounded-full">${attendanceValue}</span>`;
            
            const notesCell = row.children[4];
            notesCell.innerHTML = `<span class="text-sm text-gray-500 dark:text-gray-400">${notesInput.value || '-'}</span>`;
            
            // تغيير أزرار الإجراءات
            const actionsCell = row.children[5];
            actionsCell.innerHTML = `
                <button onclick="editLecture(this)" class="text-blue-600 hover:text-blue-900 ml-2">تعديل</button>
                <button onclick="deleteLecture(this)" class="text-red-600 hover:text-red-900">حذف</button>
            `;
            
            updateCourseStats();
            showNotification('تم حفظ بيانات المحاضرة بنجاح');
        }

        function editLecture(button) {
            const row = button.closest('tr');
            const titleCell = row.children[1];
            const attendanceCell = row.children[2];
            const gradeCell = row.children[3];
            const notesCell = row.children[4];
            
            const currentTitle = titleCell.querySelector('div').textContent;
            const currentAttendance = attendanceCell.querySelector('span').textContent;
            const currentGrade = gradeCell.querySelector('input').value;
            const currentNotes = notesCell.textContent === '-' ? '' : notesCell.textContent;
            
            titleCell.innerHTML = `<input type="text" value="${currentTitle}" class="w-full px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">`;
            attendanceCell.innerHTML = `
                <select class="px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">
                    <option value="حاضر" ${currentAttendance === 'حاضر' ? 'selected' : ''}>حاضر</option>
                    <option value="غائب" ${currentAttendance === 'غائب' ? 'selected' : ''}>غائب</option>
                </select>
            `;
            notesCell.innerHTML = `<input type="text" value="${currentNotes}" placeholder="ملاحظات" class="w-full px-2 py-1 text-sm border rounded dark:bg-gray-700 dark:text-white">`;
            
            const actionsCell = row.children[5];
            actionsCell.innerHTML = `
                <button onclick="saveLecture(this)" class="text-green-600 hover:text-green-900 ml-2">حفظ</button>
                <button onclick="deleteLecture(this)" class="text-red-600 hover:text-red-900">حذف</button>
            `;
        }

        function deleteLecture(button) {
            if (confirm('هل أنت متأكد من حذف هذه المحاضرة؟')) {
                button.closest('tr').remove();
                updateCourseStats();
                showNotification('تم حذف المحاضرة');
            }
        }

        function updateCourseStats() {
            const rows = document.querySelectorAll('#lectures-table .lecture-row');
            let totalLectures = rows.length;
            let attendedLectures = 0;
            let totalGrades = 0;
            let gradeCount = 0;
            
            rows.forEach(row => {
                const attendanceSpan = row.querySelector('td:nth-child(3) span');
                if (attendanceSpan && attendanceSpan.textContent === 'حاضر') {
                    attendedLectures++;
                }
                
                const gradeInput = row.querySelector('input[type="number"]');
                if (gradeInput && gradeInput.value > 0) {
                    totalGrades += parseInt(gradeInput.value);
                    gradeCount++;
                }
            });
            
            const attendancePercentage = totalLectures > 0 ? Math.round((attendedLectures / totalLectures) * 100) : 0;
            const averageGrade = gradeCount > 0 ? Math.round(totalGrades / gradeCount) : 0;
            
            document.getElementById('total-lectures').textContent = totalLectures;
            document.getElementById('attended-lectures').textContent = attendedLectures;
            document.getElementById('attendance-percentage').textContent = attendancePercentage + '%';
            document.getElementById('current-grade').textContent = averageGrade;
        }

        // وظائف الملف الشخصي
        function changeProfilePhoto() {
            document.getElementById('photo-upload').click();
        }

        function handlePhotoUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const profilePhoto = document.getElementById('profile-photo');
                    profilePhoto.innerHTML = `<img src="${e.target.result}" alt="صورة الملف الشخصي" class="w-full h-full object-cover rounded-full">`;
                    showNotification('تم تحديث صورة الملف الشخصي بنجاح!');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveStudentProfile() {
            const studentName = document.getElementById('student-name').value;
            const studentId = document.getElementById('student-id').value;
            const university = document.getElementById('university').value;
            const college = document.getElementById('college').value;
            const major = document.getElementById('major').value;
            const academicLevel = document.getElementById('academic-level').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            if (!studentName.trim() || !studentId.trim() || !university.trim() || !college.trim()) {
                showNotification('يرجى ملء جميع الحقول المطلوبة', 'error');
                return;
            }
            
            // حفظ في localStorage
            const profileData = {
                studentName,
                studentId,
                university,
                college,
                major,
                academicLevel,
                email,
                phone,
                savedAt: new Date().toISOString()
            };
            
            localStorage.setItem('studypal_student_profile', JSON.stringify(profileData));
            
            // تحديث الاسم في الشريط الجانبي
            const sidebarName = document.querySelector('.sidebar .text-sm.font-medium');
            if (sidebarName) {
                sidebarName.textContent = studentName;
            }
            
            const sidebarEmail = document.querySelector('.sidebar .text-xs.text-gray-500');
            if (sidebarEmail) {
                sidebarEmail.textContent = email;
            }
            
            showNotification('تم حفظ بيانات الملف الشخصي بنجاح!');
        }

        function loadStudentProfile() {
            const savedProfile = localStorage.getItem('studypal_student_profile');
            if (savedProfile) {
                try {
                    const profileData = JSON.parse(savedProfile);
                    
                    document.getElementById('student-name').value = profileData.studentName || '';
                    document.getElementById('student-id').value = profileData.studentId || '';
                    document.getElementById('university').value = profileData.university || '';
                    document.getElementById('college').value = profileData.college || '';
                    document.getElementById('major').value = profileData.major || '';
                    document.getElementById('academic-level').value = profileData.academicLevel || '4';
                    document.getElementById('email').value = profileData.email || '';
                    document.getElementById('phone').value = profileData.phone || '';
                    
                    // تحديث الشريط الجانبي
                    const sidebarName = document.querySelector('.sidebar .text-sm.font-medium');
                    if (sidebarName && profileData.studentName) {
                        sidebarName.textContent = profileData.studentName;
                    }
                    
                    const sidebarEmail = document.querySelector('.sidebar .text-xs.text-gray-500');
                    if (sidebarEmail && profileData.email) {
                        sidebarEmail.textContent = profileData.email;
                    }
                } catch (e) {
                    console.error('خطأ في تحميل بيانات الملف الشخصي:', e);
                }
            }
        }

        function handleButtonClick(buttonText) {
            console.log('Button clicked:', buttonText);
            showNotification(`تم الضغط على: ${buttonText}`);
            
            // Add click animation
            event.target.style.transform = 'translateY(1px)';
            setTimeout(() => {
                event.target.style.transform = 'translateY(0)';
            }, 100);
        }

        function handleLogout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                showNotification('تم تسجيل الخروج بنجاح');
                setTimeout(() => {
                    alert('سيتم إعادة توجيهك إلى صفحة تسجيل الدخول');
                }, 1000);
            }
        }

        function handleStatClick(title, value) {
            showNotification(`${title}: ${value}`);
        }

        function handleTaskClick(taskName, status) {
            showNotification(`المهمة: ${taskName} - الحالة: ${status}`);
        }

        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing interactions...');
            
            // Add hover effects to buttons
            const buttons = document.querySelectorAll('.btn-primary, .btn-secondary');
            buttons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
                });
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
                });
            });
            console.log(`Added hover effects to ${buttons.length} buttons`);

            // Add hover effects to stat cards
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach((card, index) => {
                card.style.cursor = 'pointer';
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-4px)';
                    this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.15)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            });
            console.log(`Added hover effects to ${statCards.length} stat cards`);

            // Add hover effects to task items
            const taskItems = document.querySelectorAll('.task-item');
            taskItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(-4px)';
                    this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
                });
                item.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0)';
                    this.style.boxShadow = 'none';
                });
            });
            console.log(`Added hover effects to ${taskItems.length} task items`);

            console.log('All interactions initialized successfully!');
            
            // Show welcome message
            setTimeout(() => {
                showNotification('مرحباً بك في StudyPal!🎉');
            }, 500);
        });
        
        // إضافة صفحات الدرجات والحضور والإعدادات المفقودة
        function addMissingPages() {
            const mainContent = document.querySelector('main');
            if (!mainContent) {
                console.error('Main content area not found');
                return;
            }
            
            // إضافة صفحة الدرجات والحضور
            const gradesContent = document.createElement('div');
            gradesContent.id = 'grades-content';
            gradesContent.className = 'page-content';
            gradesContent.style.display = 'none';
            gradesContent.innerHTML = `
                <!-- إحصائيات الأداء الأكاديمي -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 mb-8 card-hover">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8 text-center">📊 إحصائيات الأداء الأكاديمي</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-gradient-to-br from-green-400 via-green-500 to-green-600 rounded-2xl p-8 text-white card-hover transform transition-all duration-300 hover:scale-105">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-lg font-medium">🏆 المعدل التراكمي</p>
                                    <p class="text-4xl font-bold mt-2" id="cumulative-gpa">3.75</p>
                                    <p class="text-green-200 mt-1">من 4.0</p>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-full p-4">
                                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-blue-400 via-blue-500 to-blue-600 rounded-2xl p-8 text-white card-hover transform transition-all duration-300 hover:scale-105">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-lg font-medium">📚 معدل الفصل الحالي</p>
                                    <p class="text-4xl font-bold mt-2" id="current-semester-gpa">3.85</p>
                                    <p class="text-blue-200 mt-1">من 4.0</p>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-full p-4">
                                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-400 via-purple-500 to-purple-600 rounded-2xl p-8 text-white card-hover transform transition-all duration-300 hover:scale-105">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-lg font-medium">⏰ الساعات المكتملة</p>
                                    <p class="text-4xl font-bold mt-2" id="completed-hours">95</p>
                                    <p class="text-purple-200 mt-1">من 130 ساعة</p>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-full p-4">
                                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- المواد الحالية -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 mb-8 card-hover">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">📖 المواد الحالية (الفصل الدراسي الجاري)</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-right text-gray-500 dark:text-gray-400">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                <tr>
                                    <th class="px-6 py-3">اسم المادة</th>
                                    <th class="px-6 py-3">الكود</th>
                                    <th class="px-6 py-3">الساعات</th>
                                    <th class="px-6 py-3">الدرجة الحالية</th>
                                    <th class="px-6 py-3">نسبة الحضور</th>
                                    <th class="px-6 py-3">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                                    <td class="px-6 py-4 font-medium text-gray-900 dark:text-white">هندسة البرمجيات</td>
                                    <td class="px-6 py-4">CS401</td>
                                    <td class="px-6 py-4">3</td>
                                    <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">A (92%)</span></td>
                                    <td class="px-6 py-4"><span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">95%</span></td>
                                    <td class="px-6 py-4">
                                        <button onclick="trackCourse('CS401')" class="btn-primary text-xs px-3 py-1 mr-2">متابعة</button>
                                        <button onclick="markAttendance('CS401')" class="btn-secondary text-xs px-3 py-1">حضور</button>
                                    </td>
                                </tr>
                                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                                    <td class="px-6 py-4 font-medium text-gray-900 dark:text-white">قواعد البيانات</td>
                                    <td class="px-6 py-4">CS302</td>
                                    <td class="px-6 py-4">3</td>
                                    <td class="px-6 py-4"><span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded">B+ (88%)</span></td>
                                    <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">90%</span></td>
                                    <td class="px-6 py-4">
                                        <button onclick="trackCourse('CS302')" class="btn-primary text-xs px-3 py-1 mr-2">متابعة</button>
                                        <button onclick="markAttendance('CS302')" class="btn-secondary text-xs px-3 py-1">حضور</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- المواد المكتملة -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 card-hover">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">✅ المواد المكتملة (الفصول السابقة)</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-right text-gray-500 dark:text-gray-400">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                <tr>
                                    <th class="px-6 py-3">اسم المادة</th>
                                    <th class="px-6 py-3">الكود</th>
                                    <th class="px-6 py-3">الساعات</th>
                                    <th class="px-6 py-3">الدرجة النهائية</th>
                                    <th class="px-6 py-3">نسبة الحضور</th>
                                    <th class="px-6 py-3">الفصل</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                                    <td class="px-6 py-4 font-medium text-gray-900 dark:text-white">البرمجة الشيئية</td>
                                    <td class="px-6 py-4">CS201</td>
                                    <td class="px-6 py-4">3</td>
                                    <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">A (94%)</span></td>
                                    <td class="px-6 py-4"><span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">98%</span></td>
                                    <td class="px-6 py-4">الفصل الأول 2023</td>
                                </tr>
                                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                                    <td class="px-6 py-4 font-medium text-gray-900 dark:text-white">الرياضيات المتقدمة</td>
                                    <td class="px-6 py-4">MATH201</td>
                                    <td class="px-6 py-4">4</td>
                                    <td class="px-6 py-4"><span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded">B+ (87%)</span></td>
                                    <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">92%</span></td>
                                    <td class="px-6 py-4">الفصل الثاني 2023</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // إضافة صفحة الإعدادات
            const settingsContent = document.createElement('div');
            settingsContent.id = 'settings-content';
            settingsContent.className = 'page-content';
            settingsContent.style.display = 'none';
            settingsContent.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- الملف الشخصي -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 card-hover">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">👤 الملف الشخصي</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">الاسم</label>
                                <input id="user-name" type="text" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" value="محمد فرج">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">البريد الإلكتروني</label>
                                <input id="user-email" type="email" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" value="mohamed@studypal.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">رقم الهاتف</label>
                                <input id="user-phone" type="tel" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" value="+966501234567">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">التخصص</label>
                                <select id="user-major" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                    <option value="computer-science">علوم الحاسوب</option>
                                    <option value="engineering">الهندسة</option>
                                    <option value="medicine">الطب</option>
                                    <option value="business">إدارة الأعمال</option>
                                    <option value="other">أخرى</option>
                                </select>
                            </div>
                            <button onclick="saveProfile()" class="btn-primary w-full">💾 حفظ الملف الشخصي</button>
                        </div>
                    </div>

                    <!-- التفضيلات -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 card-hover">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">⚙️ التفضيلات</h3>
                        <div class="space-y-6">
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">🔔 الإشعارات</label>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">تلقي إشعارات حول المهام والمواعيد</p>
                                </div>
                                <input id="notifications-toggle" type="checkbox" checked class="w-5 h-5 text-blue-600 rounded" onchange="toggleSetting('notifications', this.checked)">
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">⏰ تذكيرات المهام</label>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">تلقي تذكيرات قبل مواعيد التسليم</p>
                                </div>
                                <input id="reminders-toggle" type="checkbox" checked class="w-5 h-5 text-blue-600 rounded" onchange="toggleSetting('reminders', this.checked)">
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">🔊 الإشعارات الصوتية</label>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">تشغيل أصوات للإشعارات</p>
                                </div>
                                <input id="sound-toggle" type="checkbox" class="w-5 h-5 text-blue-600 rounded" onchange="toggleSetting('sound', this.checked)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">⏱️ وقت التذكير المفضل</label>
                                <select id="reminder-time" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" onchange="updateReminderTime(this.value)">
                                    <option value="15">15 دقيقة قبل الموعد</option>
                                    <option value="30" selected>30 دقيقة قبل الموعد</option>
                                    <option value="60">ساعة قبل الموعد</option>
                                    <option value="120">ساعتين قبل الموعد</option>
                                    <option value="1440">يوم قبل الموعد</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">🌐 اللغة المفضلة</label>
                                <select id="language-select" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" onchange="changeLanguage(this.value)">
                                    <option value="ar" selected>العربية</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- الأمان والخصوصية -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 card-hover">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">🔒 الأمان والخصوصية</h3>
                        <div class="space-y-4">
                            <button onclick="changePassword()" class="w-full text-right px-6 py-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-900 dark:text-white">🔑 تغيير كلمة المرور</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">تحديث كلمة المرور الخاصة بك</p>
                                    </div>
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </div>
                            </button>
                            <button onclick="exportData()" class="w-full text-right px-6 py-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-gray-900 dark:text-white">📥 تصدير البيانات</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">تحميل نسخة من بياناتك</p>
                                    </div>
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- معلومات التطبيق -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 card-hover">
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">ℹ️ معلومات التطبيق</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <span class="text-gray-600 dark:text-gray-400">الإصدار</span>
                                <span class="font-medium text-gray-900 dark:text-white">1.0.0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <span class="text-gray-600 dark:text-gray-400">آخر تحديث</span>
                                <span class="font-medium text-gray-900 dark:text-white">2024/01/15</span>
                            </div>
                            <button onclick="checkUpdates()" class="w-full btn-secondary">🔄 البحث عن تحديثات</button>
                            <button onclick="contactSupport()" class="w-full btn-secondary">📞 تواصل مع الدعم</button>
                            <button onclick="showAbout()" class="w-full btn-secondary">📋 حول التطبيق</button>
                        </div>
                    </div>
                </div>
            `;
            
            mainContent.appendChild(gradesContent);
            mainContent.appendChild(settingsContent);
            
            console.log('تم إضافة صفحات الدرجات والحضور والإعدادات بنجاح!');
        }
        
        // استدعاء الدالة لإضافة الصفحات المفقودة
        addMissingPages();
        
        // اختبار localStorage فوري
        console.log('Testing localStorage...');
        try {
            localStorage.setItem('test', 'working');
            const test = localStorage.getItem('test');
            console.log('localStorage test result:', test);
            localStorage.removeItem('test');
        } catch (e) {
            console.error('localStorage not working:', e);
        }
        
        // وظيفة حفظ الملف الشخصي (مبسطة وموثوقة)
        window.saveProfile = function() {
            console.log('🔄 بدء حفظ الملف الشخصي...');
            
            try {
                // الحصول على الحقول مباشرة
                const nameField = document.getElementById('user-name');
                const emailField = document.getElementById('user-email');
                const phoneField = document.getElementById('user-phone');
                const majorField = document.getElementById('user-major');
                
                console.log('الحقول الموجودة:', {
                    name: !!nameField,
                    email: !!emailField,
                    phone: !!phoneField,
                    major: !!majorField
                });
                
                if (!nameField || !emailField) {
                    alert('❌ لم يتم العثور على حقول الملف الشخصي!\nتأكد من أنك في صفحة الإعدادات.');
                    return;
                }
                
                // استخراج القيم
                const name = nameField.value.trim();
                const email = emailField.value.trim();
                const phone = phoneField ? phoneField.value.trim() : '';
                const major = majorField ? majorField.value : '';
                
                console.log('القيم المدخلة:', { name, email, phone, major });
                
                // التحقق من الحقول المطلوبة
                if (!name) {
                    alert('⚠️ يرجى إدخال الاسم');
                    nameField.focus();
                    return;
                }
                
                if (!email) {
                    alert('⚠️ يرجى إدخال البريد الإلكتروني');
                    emailField.focus();
                    return;
                }
                
                // إنشاء كائن البيانات
                const profileData = {
                    name: name,
                    email: email,
                    phone: phone,
                    major: major,
                    savedAt: new Date().toLocaleString('ar-SA'),
                    timestamp: Date.now()
                };
                
                console.log('البيانات للحفظ:', profileData);
                
                // حفظ البيانات
                localStorage.setItem('studypal_profile', JSON.stringify(profileData));
                console.log('✅ تم الحفظ في localStorage');
                
                // التحقق من الحفظ
                const saved = localStorage.getItem('studypal_profile');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.name === name && parsed.email === email) {
                        // تحديث عرض البيانات
                        updateProfileDisplay(name, email);
                        
                        // رسالة نجاح
                        alert(`✅ تم حفظ الملف الشخصي بنجاح!\n\n📝 الاسم: ${name}\n📧 الإيميل: ${email}\n📱 الهاتف: ${phone || 'غير محدد'}\n🎓 التخصص: ${major || 'غير محدد'}\n\n⏰ وقت الحفظ: ${profileData.savedAt}`);
                        
                        console.log('✅ تم حفظ وتحديث البيانات بنجاح');
                    } else {
                        alert('❌ خطأ في التحقق من البيانات المحفوظة');
                    }
                } else {
                    alert('❌ فشل في حفظ البيانات');
                }
                
            } catch (error) {
                console.error('❌ خطأ في الحفظ:', error);
                alert('❌ حدث خطأ أثناء الحفظ: ' + error.message);
            }
        }
        
        // إنشاء حقول الملف الشخصي إذا لم توجد
        function createProfileFields() {
            const settingsContent = document.getElementById('settings-content');
            if (!settingsContent) {
                console.log('إنشاء صفحة الإعدادات...');
                // سيتم إضافتها بواسطة addMissingPages
                return;
            }
            console.log('تم العثور على صفحة الإعدادات');
        }
        
        function updateProfileDisplay(name, email) {
            console.log('تحديث عرض البيانات في الواجهة...');
            
            // تحديث جميع عناصر الاسم
            const nameSelectors = ['#profile-name', '.profile-name', '#profile-student-name', '.user-name', '.sidebar-user-name'];
            nameSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                    if (el) {
                        el.textContent = name;
                        console.log(`تم تحديث ${selector}:`, el);
                    }
                });
            });
            
            // تحديث جميع عناصر الإيميل
            const emailSelectors = ['#profile-email', '.profile-email', '#profile-student-email'];
            emailSelectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                    if (el) {
                        el.textContent = email;
                        console.log(`تم تحديث ${selector}:`, el);
                    }
                });
            });
        }
        
        function toggleSetting(settingName, isEnabled) {
            try {
                const settings = JSON.parse(localStorage.getItem('studypal_settings') || '{}');
                settings[settingName] = isEnabled;
                localStorage.setItem('studypal_settings', JSON.stringify(settings));
                
                const statusText = isEnabled ? 'تم تفعيل' : 'تم إلغاء';
                showNotification(`${statusText} ${getSettingDisplayName(settingName)} ⚙️`);
                
                console.log(`Setting ${settingName} updated:`, isEnabled);
            } catch (error) {
                console.error('Error updating setting:', error);
            }
        }
        
        function getSettingDisplayName(settingName) {
            const names = {
                'notifications': 'الإشعارات',
                'reminders': 'التذكيرات',
                'sound': 'الأصوات'
            };
            return names[settingName] || settingName;
        }
        
        function updateReminderTime(minutes) {
            try {
                const settings = JSON.parse(localStorage.getItem('studypal_settings') || '{}');
                settings.reminderTime = minutes;
                localStorage.setItem('studypal_settings', JSON.stringify(settings));
                
                showNotification(`تم تحديث وقت التذكير إلى ${minutes} دقيقة ⏰`);
            } catch (error) {
                console.error('Error updating reminder time:', error);
            }
        }
        
        function changeLanguage(language) {
            try {
                const settings = JSON.parse(localStorage.getItem('studypal_settings') || '{}');
                settings.language = language;
                localStorage.setItem('studypal_settings', JSON.stringify(settings));
                
                const langName = language === 'ar' ? 'العربية' : 'English';
                showNotification(`تم تغيير اللغة إلى ${langName} 🌐`);
            } catch (error) {
                console.error('Error changing language:', error);
            }
        }
        
        function changePassword() {
            showNotification('ميزة تغيير كلمة المرور ستكون متاحة قريباً 🔐');
        }
        
        function exportData() {
            try {
                const profileData = JSON.parse(localStorage.getItem('studypal_profile') || '{}');
                const settingsData = JSON.parse(localStorage.getItem('studypal_settings') || '{}');
                const tasksData = JSON.parse(localStorage.getItem('studypal_tasks') || '[]');
                
                const exportData = {
                    profile: profileData,
                    settings: settingsData,
                    tasks: tasksData,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `studypal_data_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showNotification('تم تصدير البيانات بنجاح! 📥');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('حدث خطأ أثناء تصدير البيانات ❌', 'error');
            }
        }
        
        function checkUpdates() {
            showNotification('لا توجد تحديثات متاحة حالياً 🔄');
        }
        
        function contactSupport() {
            showNotification('يمكنك التواصل معنا على: support@studypal.com 📞');
        }
        
        function showAbout() {
            showNotification('StudyPal v1.0.0 - تطبيق إدارة الدراسة الذكي 📋');
        }
        
        // تحميل البيانات المحفوظة عند تحميل الصفحة
        function loadSavedProfile() {
            try {
                const savedProfile = localStorage.getItem('studypal_profile');
                console.log('Loading saved profile:', savedProfile);
                
                if (savedProfile) {
                    const profileData = JSON.parse(savedProfile);
                    console.log('Parsed profile data:', profileData);
                    
                    // البحث عن الحقول بطرق متعددة
                    setTimeout(() => {
                        const nameField = document.getElementById('user-name') || document.querySelector('input[placeholder*="اسم"]');
                        const emailField = document.getElementById('user-email') || document.querySelector('input[type="email"]');
                        const phoneField = document.getElementById('user-phone') || document.querySelector('input[type="tel"]');
                        const majorField = document.getElementById('user-major') || document.querySelector('select');
                        
                        console.log('حقول الملف الشخصي الموجودة:', {
                            name: !!nameField,
                            email: !!emailField,
                            phone: !!phoneField,
                            major: !!majorField
                        });
                        
                        // تحديث الحقول إذا وجدت
                        if (nameField && profileData.name) {
                            nameField.value = profileData.name;
                            console.log('تم تحديث حقل الاسم:', profileData.name);
                        }
                        if (emailField && profileData.email) {
                            emailField.value = profileData.email;
                            console.log('تم تحديث حقل الإيميل:', profileData.email);
                        }
                        if (phoneField && profileData.phone) {
                            phoneField.value = profileData.phone;
                            console.log('تم تحديث حقل الهاتف:', profileData.phone);
                        }
                        if (majorField && profileData.major) {
                            majorField.value = profileData.major;
                            console.log('تم تحديث حقل التخصص:', profileData.major);
                        }
                        
                        // تحديث عرض البيانات في جميع أنحاء الموقع
                        updateProfileDisplay(profileData.name, profileData.email);
                        
                        console.log('✅ تم تحميل بيانات الملف الشخصي بنجاح');
                    }, 200);
                } else {
                    console.log('لا توجد بيانات محفوظة للملف الشخصي');
                }
                
                // تحميل إعدادات التطبيق
                const savedSettings = localStorage.getItem('studypal_settings');
                if (savedSettings) {
                    const settingsData = JSON.parse(savedSettings);
                    console.log('تحميل الإعدادات:', settingsData);
                    
                    // تطبيق الإعدادات المحفوظة
                    setTimeout(() => {
                        const toggles = {
                            'notifications-toggle': settingsData.notifications,
                            'reminders-toggle': settingsData.reminders,
                            'sound-toggle': settingsData.sound
                        };
                        
                        Object.entries(toggles).forEach(([id, value]) => {
                            const element = document.getElementById(id);
                            if (element && value !== undefined) {
                                element.checked = value;
                                console.log(`تم تحديث ${id}:`, value);
                            }
                        });
                        
                        // تحديث القوائم المنسدلة
                        const selects = {
                            'reminder-time': settingsData.reminderTime,
                            'language-select': settingsData.language
                        };
                        
                        Object.entries(selects).forEach(([id, value]) => {
                            const element = document.getElementById(id);
                            if (element && value) {
                                element.value = value;
                                console.log(`تم تحديث ${id}:`, value);
                            }
                        });
                    }, 300);
                }
                
            } catch (error) {
                console.error('❌ خطأ في تحميل البيانات المحفوظة:', error);
            }
        }
        
        // تحميل البيانات المحفوظة بعد إضافة الصفحات (محسن)
        setTimeout(() => {
            console.log('🔄 بدء تحميل البيانات المحفوظة...');
            loadSavedProfile();
        }, 1000);
        
        // تحميل إضافي عند تبديل الصفحات
        function ensureDataLoaded() {
            setTimeout(() => {
                loadSavedProfile();
            }, 300);
        }
        
        // تم إزالة زر اختبار الحفظ بناءً على طلب المستخدم
        

        function checkLocalStorage() {
            const saved = localStorage.getItem('studypal_profile');
            console.log('Current localStorage content:', saved);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    console.log('Parsed data:', data);
                } catch (e) {
                    console.error('Error parsing saved data:', e);
                }
            }
        }
        

        setInterval(checkLocalStorage, 5000);
        

        checkLocalStorage();
        

        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('Page became visible, reloading profile data...');
                setTimeout(loadSavedProfile, 500);
            }
        });
        

        document.addEventListener('click', function(e) {
            if (e.target.textContent === 'الإعدادات') {
                console.log('Settings page clicked, loading profile data...');
                setTimeout(loadSavedProfile, 200);
            }
        });
        

        let currentUser = null;
        
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('studypal_logged_in') === 'true';
            const userEmail = localStorage.getItem('studypal_user_email');
            const userName = localStorage.getItem('studypal_user_name');
            
            if (isLoggedIn && userEmail) {
                showWelcomeSection(userName || 'المستخدم', userEmail);
                return true;
            }
            
            showAuthSection();
            return false;
        }
        
        function showAuthSection() {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.querySelector('.min-h-screen.flex').style.display = 'none';
        }
        
        function showWelcomeSection(name, email) {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('welcomeSection').style.display = 'block';
            document.getElementById('userInfo').innerHTML = `
                <strong>الاسم:</strong> ${name}<br>
                <strong>البريد الإلكتروني:</strong> ${email}
            `;
        }
        
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.auth-tab');
            const forms = document.querySelectorAll('.auth-form');
            
            tabs.forEach(t => {
                t.style.color = '#666';
                t.style.background = 'transparent';
                t.style.boxShadow = 'none';
            });
            forms.forEach(f => f.style.display = 'none');
            
            if (tab === 'login') {
                tabs[0].style.color = '#667eea';
                tabs[0].style.background = 'white';
                tabs[0].style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                document.getElementById('loginForm').style.display = 'block';
            } else {
                tabs[1].style.color = '#667eea';
                tabs[1].style.background = 'white';
                tabs[1].style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                document.getElementById('registerForm').style.display = 'block';
            }
            
            hideStatus();
        }
        
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const toggle = field.nextElementSibling;
            
            if (field.type === 'password') {
                field.type = 'text';
                toggle.textContent = '🙈';
            } else {
                field.type = 'password';
                toggle.textContent = '👁️';
            }
        }
        
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            const btnText = document.getElementById('loginBtnText');
            
            if (!email || !password) {
                showStatus('يرجى إدخال البريد الإلكتروني وكلمة المرور', 'error');
                return;
            }
            
            btn.disabled = true;
            btnText.innerHTML = '<span style="display: inline-block; width: 20px; height: 20px; border: 2px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s ease-in-out infinite;"></span> جاري تسجيل الدخول...';
            
            setTimeout(() => {
                const userData = {
                    name: 'أحمد محمد',
                    email: email,
                    loginMethod: 'email',
                    loginTime: new Date().toISOString()
                };
                
                saveUserData(userData);
                showStatus('تم تسجيل الدخول بنجاح! 🎉', 'success');
                
                setTimeout(() => {
                    document.getElementById('loginPage').style.display = 'none';
                    document.querySelector('.min-h-screen.flex').style.display = 'flex';
                    setTimeout(loadSavedProfile, 500);
                }, 1000);
                
                btn.disabled = false;
                btnText.textContent = 'تسجيل الدخول';
            }, 1500);
        }
        
        function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const btn = document.getElementById('registerBtn');
            const btnText = document.getElementById('registerBtnText');
            
            if (!name || !email || !password || !confirmPassword) {
                showStatus('يرجى ملء جميع الحقول', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showStatus('كلمات المرور غير متطابقة', 'error');
                return;
            }
            
            if (password.length < 6) {
                showStatus('كلمة المرور يجب أن تكون 6 أحرف على الأقل', 'error');
                return;
            }
            
            btn.disabled = true;
            btnText.innerHTML = '<span style="display: inline-block; width: 20px; height: 20px; border: 2px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s ease-in-out infinite;"></span> جاري إنشاء الحساب...';
            
            setTimeout(() => {
                const userData = {
                    name: name,
                    email: email,
                    loginMethod: 'email',
                    registrationTime: new Date().toISOString()
                };
                
                saveUserData(userData);
                showStatus('تم إنشاء الحساب بنجاح! 🎉', 'success');
                
                setTimeout(() => {
                    document.getElementById('loginPage').style.display = 'none';
                    document.querySelector('.min-h-screen.flex').style.display = 'flex';
                    setTimeout(loadSavedProfile, 500);
                }, 1000);
                
                btn.disabled = false;
                btnText.textContent = 'إنشاء حساب جديد';
            }, 2000);
        }
        
        function signInWithGoogle() {
            showStatus('جاري تسجيل الدخول بـ Google...', 'success');
            
            setTimeout(() => {
                const userData = {
                    name: 'أحمد محمد (Google)',
                    email: 'ahmed@gmail.com',
                    loginMethod: 'google',
                    loginTime: new Date().toISOString()
                };
                
                saveUserData(userData);
                showStatus('تم تسجيل الدخول بـ Google بنجاح! 🎉', 'success');
                
                setTimeout(() => {
                    document.getElementById('loginPage').style.display = 'none';
                    document.querySelector('.min-h-screen.flex').style.display = 'flex';
                    setTimeout(loadSavedProfile, 500);
                }, 1000);
            }, 1500);
        }
        
        function signUpWithGoogle() {
            showStatus('جاري التسجيل بـ Google...', 'success');
            
            setTimeout(() => {
                const userData = {
                    name: 'أحمد محمد (Google)',
                    email: 'ahmed@gmail.com',
                    loginMethod: 'google',
                    registrationTime: new Date().toISOString()
                };
                
                saveUserData(userData);
                showStatus('تم إنشاء الحساب بـ Google بنجاح! 🎉', 'success');
                
                setTimeout(() => {
                    document.getElementById('loginPage').style.display = 'none';
                    document.querySelector('.min-h-screen.flex').style.display = 'flex';
                    setTimeout(loadSavedProfile, 500);
                }, 1000);
            }, 1500);
        }
        
        function saveUserData(userData) {
            localStorage.setItem('studypal_logged_in', 'true');
            localStorage.setItem('studypal_user_email', userData.email);
            localStorage.setItem('studypal_user_name', userData.name);
            localStorage.setItem('studypal_user_data', JSON.stringify(userData));
            localStorage.setItem('studypal_user', JSON.stringify(userData));
            localStorage.setItem('studypal_profile', JSON.stringify(userData));
            currentUser = userData;
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.display = 'block';
            status.style.fontWeight = '500';
            
            if (type === 'success') {
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                status.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                status.style.background = '#f8d7da';
                status.style.color = '#721c24';
                status.style.border = '1px solid #f5c6cb';
            }
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        function hideStatus() {
            const status = document.getElementById('status');
            status.style.display = 'none';
        }
        
        function goToDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.querySelector('.min-h-screen.flex').style.display = 'flex';
            setTimeout(loadSavedProfile, 500);
        }
        
        function handleLogout() {
            const keys = [
                'studypal_logged_in',
                'studypal_user_email',
                'studypal_user_name',
                'studypal_user_data',
                'studypal_user',
                'studypal_profile',
                'token',
                'user'
            ];
            
            keys.forEach(key => localStorage.removeItem(key));
            currentUser = null;
            
            showStatus('تم تسجيل الخروج بنجاح! 👋', 'success');
            
            setTimeout(() => {
                showAuthSection();
                hideStatus();
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
            }, 1500);
        }
        
        // Add CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            
            .auth-tab:hover {
                background: #f0f0f0 !important;
            }
            
            input:focus {
                outline: none !important;
                border-color: #667eea !important;
                background: white !important;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
            }
            
            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            }
            
            button:disabled {
                transform: none !important;
                box-shadow: none !important;
            }
        `;
        document.head.appendChild(style);
        
        // Initialize login status on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
        });
        
        // Also check immediately
        setTimeout(checkLoginStatus, 100);
        
        // Check login status periodically
        setInterval(checkLoginStatus, 2000);
    </script>
</body>
</html>
